---
title: "Laravelã§ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒª(ãƒ¢ãƒ‡ãƒ«ã®ä½œæˆã¾ã§)"
emoji: "ğŸ¤–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["php", "laravel", "android", "termux"]
published: false
---
@[card](https://zenn.dev/dameyodamedame/articles/a5a281b10e96e3)

ä¸Šè¨˜ã®è¨˜äº‹ã®è©³ç´°è¨˜äº‹ã§ã™ã€‚

# ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã®ä½œæˆ

ã‚ˆã†ã‚„ãé››å½¢ãŒå‡ºæ¥ãŸã®ã§ã€ã‚¢ãƒ—ãƒªã‚’å°‘ã—ãšã¤ä½œæˆã—ã¦ã„ãã¾ã™ã€‚ä»Šå›ã®ãŠé¡Œã¯ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã§ã™ã€‚ã‚³ãƒ¼ãƒ‰ã¯åŸºæœ¬çš„ã«Laravelã®é››å½¢ã‚’Gemini 2.5 flash(2025å¹´5æœˆç¾åœ¨åŒ¿åç„¡æ–™ã§ä½¿ç”¨ã§ãã‚‹ã‚‚ã®)ã‚’ä½¿ã£ã¦å®Ÿè£…ã—ãŸã‚‚ã®ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦ã„ã¾ã™ã€‚

# è¦ä»¶

- å…¨å“¡1ã¤ã®éƒ¨å±‹ã«å…¥ã‚‹
- åŒ¿åã§ã‚‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‚‚ç™ºè¨€ã§ãã‚‹
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ä»–äººã®ç™ºè¨€ãŒèª­ã‚ã‚‹(â€»)
- ç·¨é›†/å‰Šé™¤ã™ã‚‰ã§ããšã€1æ—¥1å›1æ—¥ä»¥ä¸ŠçµŒéã—ãŸç™ºè¨€ã¯é¯–ã‹ã‚‰æ¶ˆãˆã‚‹
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã‚‚1åˆ†ã«1å›1æ—¥ä»¥ä¸ŠçµŒéã—ãŸç™ºè¨€ã‚’ç”»é¢ã‹ã‚‰æ¶ˆã™
- 1å›ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§èª­ã‚ã‚‹ç™ºè¨€ã¯50ä»¶ã¾ã§(æ‰€å®šæ™‚é–“ã‹ã‚‰æœ€å¤§50ä»¶åˆ†ã¨æœ€æ–°ã¾ã§æœ€å¤§50ä»¶ã€‚1æ—¥ä»¥ä¸ŠçµŒéã—ãŸç™ºè¨€ã¯è¿”ã•ãªã„)

â€»SSE(Server-Sent Event)ã‚’ä½¿ç”¨ã—ã¾ã™

# ã“ã®è¨˜äº‹ã§ã®ã‚´ãƒ¼ãƒ«ã¨ã‚ˆã‚Šè©³ç´°ãªä»•æ§˜

- åˆæœŸè¡¨ç¤ºã®ã¿
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ãªã—
- ã‚ªãƒ³ãƒ©ã‚¤ãƒ³äººæ•°è¡¨ç¤ºãªã—
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’50ä»¶ã¾ã§è¡¨ç¤º
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚„èªè¨¼/è¨­å®šã¯Laravelã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’ä½¿ç”¨
- èªè¨¼ã•ã‚Œã¦ã‚‹å ´åˆã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼å/ã•ã‚Œã¦ãªã„å ´åˆã¯åŒ¿åã§è¡¨ç¤º
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã«ã‚ã‚‹ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã¨ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã®ä¸¡æ–¹ã§è¡¨ç¤ºã§ãã‚‹
- ä¸Šè¨˜ã«å¿…è¦ãª**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«ä½œæˆã¾ã§**

# ãƒ¢ãƒ‡ãƒ«ã®ä½œæˆ

ãƒ¢ãƒ‡ãƒ«ã¨è¨€ã£ã¦ã‚‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«ã®ã“ã¨ã§ã™ã€‚
ã›ã£ã‹ããªã®ã§ã€è¨­è¨ˆã£ã½ã„å›³ã‚’é›°å›²æ°—ã ã‘å…¥ã‚Œã¦ãŠãã¾ã™ã€‚

## ERå›³

ä»Šã®ã¨ã“ã‚[ERå›³](https://ja.wikipedia.org/wiki/%E5%AE%9F%E4%BD%93%E9%96%A2%E9%80%A3%E3%83%A2%E3%83%87%E3%83%AB)(ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è¡¨ã®é–¢ä¿‚ã‚’å›³ç¤ºã—ãŸã‚‚ã®)ã§ã¯ã“ã®ç¨‹åº¦ã§ã™ã€‚

```mermaid
---
title: "ERå›³"
---
erDiagram
    users |o--o{ chats: ""

    users {
        bigint(20) id PK
        varchar(255) name "NOT NULL"
        varchar(255) email UK "NOT NULL"
        timestamp email_verified_at
        varchar(255) password "NOT NULL"
        varchar(100) remember_token
        timestamp created_at
        timestamp updated_at
    }

    chats {
        bigint(20) id PK
        bigint(20) user_id FK
        varchar(4096) message "NOT NULL"
        timestamp created_at
        timestamp updated_at
    }
```

ã“ã“ã§usersãƒ†ãƒ¼ãƒ–ãƒ«ã¯Laravelã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã§ã™ã€‚
chatsãƒ†ãƒ¼ãƒ–ãƒ«ãŒä»Šå›ä½œã‚‹éƒ¨åˆ†ã§ã™ã­ã€‚

## ã‚¯ãƒ©ã‚¹å›³

ä¸Šã®ERå›³ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒ[ã‚¯ãƒ©ã‚¹å›³](https://ja.wikipedia.org/wiki/%E3%82%AF%E3%83%A9%E3%82%B9%E5%9B%B3)ã®ã‚¯ãƒ©ã‚¹ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚

```mermaid
---
title: ã‚¯ãƒ©ã‚¹å›³
---
classDiagram
    class User {
        +integer id
        +string name
        +string email
        +Carbon email_verified_at
        #string password
        #string remember_token
        +Carbon created_at
        +Carbon updated_at
    }

    class Chat {
        +integer id
        +integer user_id
        +string message
        +Carbon created_at
        +Carbon updated_at
    }

    User "0..1" <-- "0..*" Chat
```

â€» Modelæ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã®å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ãŒã“ã†ã„ã†æ§‹é€ ãªã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€æ„å‘³åˆã„çš„ã«ã¯ã“ã‚“ãªå‹•ãã‚’ã—ã¦ã„ã¾ã™ã€‚

## ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ

ERå›³ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã‚¯ãƒ©ã‚¹å›³ã®ã‚¯ãƒ©ã‚¹ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã‚‚ã®ã‚’[ORM](https://ja.wikipedia.org/wiki/%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E9%96%A2%E4%BF%82%E3%83%9E%E3%83%83%E3%83%94%E3%83%B3%E3%82%B0)ã¨ã„ã†ã®ã§ã™ãŒã€Laravelã§ã“ã®ORMã‚’æ‹…ã£ã¦ã„ã‚‹ã®ãŒ[Eloquent](https://laravel.com/docs/12.x/eloquent)ã§ã™ã€‚

ä»¥ä¸‹ã§ã¯Eloquentãƒ¢ãƒ‡ãƒ«ã‚¯ãƒ©ã‚¹ã¨ãã®é–¢é€£ã‚¯ãƒ©ã‚¹ã®é››å½¢ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™ã€‚

```shell-session
~/php/example-app $ php artisan make:model Chat --all

   INFO  Model [app/Models/Chat.php] created successfully.

   INFO  Factory [database/factories/ChatFactory.php] created successfully.

   INFO  Migration [database/migrations/????_??_??_??????_create_chats_table.php] created successfully.

   INFO  Seeder [database/seeders/ChatSeeder.php] created successfully.

   INFO  Request [app/Http/Requests/StoreChatRequest.php] created successfully.

   INFO  Request [app/Http/Requests/UpdateChatRequest.php] created successfully.

   INFO  Controller [app/Http/Controllers/ChatController.php] created successfully.

   INFO  Policy [app/Policies/ChatPolicy.php] created successfully.

~/php/example-app $
```

## å®Ÿè£…

ä½œã£ã¦ã‚‚ã‚‰ã£ãŸé››å½¢ã®ã‚¯ãƒ©ã‚¹ã‚’å…ƒã«å®Ÿè£…ã‚’åŸ‹ã‚ã¦ã„ãã¾ã™ã€‚

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³(ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ)

ã¾ãšã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ([migration](https://laravel.com/docs/12.x/migrations#migration-structure)(è‹±èªçš„ã«ã¯ç§»è¡Œã¨ã„ã†æ„å‘³ã§ã™))ã‹ã‚‰ã€‚Laravelã§ã¯ã¾ãšãƒ†ãƒ¼ãƒ–ãƒ«ã‚ã‚Šãã§ãƒ¢ãƒ‡ãƒ«ãŒæ±ºã¾ã‚‹ã‚ˆã†ãªã®ã§ã€‚

```php:database/migrations/????_??_??_??????_create_chats_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('chats', function (Blueprint $table) {
            $table->id();
            $table->foreignId('user_id')->nullable()->constrained()->onDelete('cascade');
            $table->string('message', 4096);
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('chats');
    }
};
```

ã¾ãšã¯NULLè¨±å®¹ã§Usersãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¼µã‚Šã€cascadeã®è¨­å®šã‚‚ã—ã¦ã„ã¾ã™ã€‚æ¬¡ã«messageã‚«ãƒ©ãƒ ã‚’å®šç¾©ã—ã¦æœ€å¤§4096ãƒã‚¤ãƒˆã®æ–‡å­—åˆ—ã¨ã—ã¦ã„ã¾ã™ã€‚

(åæ˜ ã¯ã“ã“ã§ã¯ã—ã¾ã›ã‚“ãŒ)å®Ÿéš›ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«åæ˜ ã™ã‚‹ã¨ã€ã“ã‚“ãªãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œã‚‰ã‚Œã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

```sql
CREATE TABLE `chats` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `user_id` bigint(20) unsigned DEFAULT NULL,
  `message` varchar(4096) NOT NULL,
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `chats_user_id_foreign` (`user_id`),
  CONSTRAINT `chats_user_id_foreign` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
```

â€» maridbã®SQLã‹ã‚‰`show create table chats`ã‚’å®Ÿè¡Œã—ãŸçµæœã§ã™

### ãƒ¢ãƒ‡ãƒ«

æ¬¡ã¯[Model](https://laravel.com/docs/12.x/eloquent#eloquent-model-conventions)æœ¬ä½“ã®å®Ÿè£…ã§ã™ã€‚

```php:app/Models/Chat.php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;

class Chat extends Model
{
    /** @use HasFactory<\Database\Factories\ChatFactory> */
    use HasFactory;

    protected $fillable = [
        'user_id',
        'message',
    ];

    public function user(): BelongsTo
    {
        return $this->belongsTo(User::class);
    }
}
```

å‰è¿°ã—ãŸã‚ˆã†ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã‚’å…ƒã«ç”Ÿæˆã•ã‚Œã‚‹ã‚ˆã†ãªã®ã§ã€ãƒ¢ãƒ‡ãƒ«è‡ªä½“ã‚’äº‹ç´°ã‹ã«è¨˜è¿°ã™ã‚‹å¿…è¦ã¯ãªã„ã®ã§ã™ãŒã€ãƒãƒ«ã‚¯å‡¦ç†([fillable](https://laravel.com/docs/12.x/eloquent#mass-assignment))ã¨[ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®è¨˜è¿°](https://laravel.com/docs/12.x/eloquent-relationships#one-to-many-inverse)ã¯å¿…è¦ãªã‚ˆã†ã§ã™ã€‚

### ãƒ•ã‚¡ã‚¯ãƒˆãƒª

æ¬¡ã«ä½œã£ãŸãƒ¢ãƒ‡ãƒ«ã®ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ã©ã†ä½œã‚‹ã‹([factory](https://laravel.com/docs/12.x/eloquent-factories))ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ãƒ†ã‚¹ãƒˆã¨ã‹ã§ä½¿ã„ã¾ã™ã€‚

```php:database/factories/ChatFactory.php
<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use App\Models\User;
use Illuminate\Support\Facades\DB;

/**
 * @extends \Illuminate\Database\Eloquent\Factories\Factory<\App\Models\Chat>
 */
class ChatFactory extends Factory
{
     protected $model = \App\Models\Chat::class;

    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {
        $usersCount = DB::table('users')->count();
        $userId = null;
        if ($usersCount > 0 && $this->faker->boolean()) {
            $userId = User::inRandomOrder()->first()->id;
        }

        return [
            'user_id' => $userId,
            'message' => $this->faker->realtext,
        ];
    }
}
```

fakerã¨ã„ã†ã®ãŒä¾¿åˆ©ã§ã™ã­ã€‚

### ã‚·ãƒ¼ãƒ‰

ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ä½œã‚‹éš›ã«ä½¿ç”¨ã™ã‚‹ã‚³ãƒ¼ãƒ‰([seed](https://laravel.com/docs/12.x/seeding))ã§ã™ã€‚ä½•å€‹ä½œã‚‹ã‹ã¿ãŸã„ãªã¨ã“ã‚ã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚

```php:database/seeders/ChatSeeder.php
<?php

namespace Database\Seeders;

use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;
use App\Models\Chat;

class ChatSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        Chat::factory()->count(10)->create();
    }
}
```

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®åæ˜ (ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)

ç¢ºèªã‚‚å…¼ã­ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«åæ˜ ã—ã¦ãŠãã¾ã™ã€‚ãŸã ãã®ã¾ã¾åæ˜ ã™ã‚‹ã¨è‹±èªã«ãªã£ã¦ã—ã¾ã†ã®ã§ã€åæ˜ å‰ã«è¨­å®šã‚’å¤‰æ›´ã—ã¾ã™ã€‚

```shell:.env
...
#APP_LOCALE=en
APP_LOCALE=ja
#APP_FALLBACK_LOCALE=en
APP_FALLBACK_LOCALE=ja
#APP_FAKER_LOCALE=en_US
APP_FAKER_LOCALE=ja_JP
...
```

ã§ã¯åæ˜ ã—ã¾ã™ã€‚

```shell-session
~/php/example-app $ php artisan migrate:fresh

  Dropping all tables .................................................................... 25.79ms DONE

   INFO  Preparing database.

  Creating migration table ............................................................... 16.72ms DONE

   INFO  Running migrations.

  0001_01_01_000000_create_users_table ................................................... 37.85ms DONE
  0001_01_01_000001_create_cache_table ................................................... 12.06ms DONE
  0001_01_01_000002_create_jobs_table .................................................... 30.28ms DONE
  ????_??_??_??????_create_chats_table ................................................... 31.66ms DONE

~/php/example-app $ 
```

## ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆ

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç”¨æ„ã•ã‚Œã¦ã‚‹ãƒ€ãƒŸãƒ¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œã‚Šã¾ã™ã€‚

```shell-session
~/php/example-app $ php artisan db:seed

   INFO  Seeding database.

~/php/example-app $
```

ä½œæˆã—ãŸãƒ¢ãƒ‡ãƒ«ã®ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ä½œã‚Šã¾ã™ã€‚

```shell-session
~/php/example-app $ php artisan db:seed --class=ChatSeeder

   INFO  Seeding database.

~/php/example-app $ 
```

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç¢ºèª

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä¸­èº«ã‚’ç¢ºèªã—ã¾ã™ã€‚Laravelã®[REPL](https://ja.wikipedia.org/wiki/REPL)ã§ã‚ã‚‹[tinker](https://laravel.com/docs/12.x/artisan#tinker)ã‚’ä½¿ã„ã¾ã™ã€‚

```shell-session
~/php/example-app $ php artisan tinker
Psy Shell v0.12.8 (PHP 8.4.2 â€” cli) by Justin Hileman
> App\Models\Chat::all()
= Illuminate\Database\Eloquent\Collection {#1365
    all: [
      App\Models\Chat {#6244
        id: 1,
        user_id: 1,
        message: "ã¾ã‚Œã¦ã„ã—ã¦ã¤ã©ã†ã‹ã€ã¾ã‚ã£ã¦ã‚‹ã‚“ã ã‚“å¤§ããªã‚Šã€å¤©ã®å·ã®æ°´ãã‚ã«æ²¿ãã£ã¡ã«å›²ã‹ã“ã¨ãªã‚Š
ã€å§‰ã­ãˆã€ãŠã—ã¾ã„ã¾ã—ãŸã€‚ã€Œã“ã©ã‚‚ã»ã‚“ã¨ã¯ãªãœã‹ã•ã‚ã€ã¼ãã ã•ã„ã€ã‚¸ãƒ§ãƒãƒ³ãƒ‹ã¯å‹¢ã„ããªã‚Šã€ã¾ã‚‹ã§é‹å‹•å ´ã†
ã‚“ã©ã„é«˜ã„é«˜åŸã§å¾…ã¾ã£ã¦è¦‹ã¾ã—ãŸã€‚ãã—ã¦ã€ã¾ã‚‚ãªããªã‚Šã€å§‰ã­ãˆã€ã€Œã©ã†ã‚‚æ¸ˆã™ã¿ã®ã‚ˆã†ã§æ©‹ã¯ã—ã‚‰ãŒãã®é»’ã„
é–€ã‚‚ã‚“ã‚’ãŸã¦ã¦ã„ãŸã®ã§ã—ãŸã€‚ãã—ã¦ã€ãã“ã‚‰ã«ã²ã–ã®é»’ã„æœãµããªã‚Šã„ã‚ã®æ–¹ã¸æŠ¼ãŠã—ã¦ãã³ã‚’ãŸã¦ã¦ã„ã—ã‚‡ã«ã—
ã€‚",
        created_at: "????-??-?? ??:??:??",
        updated_at: "????-??-?? ??:??:??",
      },
      App\Models\Chat {#6245
        id: 2,
        user_id: 1,
        message: "ã‚“ã¨ã†ã«çœ¼ã‚ã‚’ã¿ã¦ã€ã‚ã™ã“çŸ³ç‚­è¢‹ã›ãã®ã©ãã³ã«ã¶ã£ãã‚Šã‚“ã¨ã†ã®ã¯ã˜ã‚ã¯ã©ã†ã—ã¦ã—ã¾ã£é»’
ãªç›¤ã°ã‚“ã§ãªã—ãã‚ãã‚ˆã†ãªè‰²ã‚’ã—ã¦ã„ã‚‹ã‚ˆã†ãªã‚“ã ã‹é¼»ã¯ãªã‚Œã¦æ¥ã¦ã€ã‚ãŸã—ãŸã€‚ã€Œé³¥ãŒãŠã‚‚ã—ãŠã¾ãŸã€é«˜ãæ˜Ÿã‚
ãã£ãŸã‚Šã¯ã€é ‚ã„ãŸã„ã‚ˆãçŸ¥ã‚Šã¾ã›ã‚“ã§ã™ã€‚ãã—ã¦ãã¦ã€ã¾ã ã²ã–ã¾ãšã„ã¶ã‚“ã„ãŸã®ã§ã—ãŸã‚‚ã‚“ã§è¡Œãã‚“ã€é¢¨ã®ã‚ˆã†
ã«é›‘ä½œãã†ã•ãˆãã¡ã£ã¨ç¶šã¤ã¥ã„ã¦ã¯ã„ã£ã±ã•ã‚’ã‚ã‘ã¦è¡Œã‹ãªã„ã‚“ã ã‹ã‚‰é£›ã¨ã³ä¹—ã®ã‚Šã¾ã—ãŸã€‚ãã‚‰ã®ã‚ˆã†ãªã‚“ã ã‚ˆ
ã€‚",
...
      },
    ],
  }

> exit

   INFO  Goodbye.

~/php/example-app $
```

å‡ºæ¥ã¦ã„ã‚‹ã‚ˆã†ãªã®ã§ã€æ¬¡ã¯è»½ããƒ†ã‚¹ãƒˆã§ã™ã€‚

## ãƒ†ã‚¹ãƒˆ

ã“ã“ã¾ã§ã‚ã¾ã‚Šæ›¸ã„ã¦ãã¦ã„ã¾ã›ã‚“ã§ã—ãŸãŒã€Termuxã§ã¯[xdebug](https://en.wikipedia.org/wiki/Xdebug)ãŒå‹•ã‹ãšã€**ãƒ‡ãƒãƒƒã‚°ãŒã§ãã¾ã›ã‚“**ã€‚ãªã®ã§ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã¯å¿…é ˆã€æ§ãˆã‚ã«è¨€ã£ã¦ã‚‚çµæ§‹é‡è¦ãªã®ã§ã™ã€‚ã¾ãŸAndroidãªã®ã§ã€PCãŒãªã„ã¨Webãƒ–ãƒ©ã‚¦ã‚¶ã§(æ™®é€šã«ã¯)**é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ãŒä½¿ãˆãªã„**ã“ã¨ã‚‚è¼ªã‚’ã‹ã‘ã¦ãƒ‡ãƒãƒƒã‚°ã‚’å›°é›£ã«ã—ã¦ã„ã¾ã™ã€‚é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã®å•é¡Œã¯Termuxã«ãŠã‘ã‚‹(node.jsãªã©)å…¨ã¦ã®Webã‚¢ãƒ—ãƒª/ã‚µãƒ¼ãƒ“ã‚¹é–‹ç™ºã§è¨€ãˆã‚‹å•é¡Œã§ã™ã­ã€‚

ã¾ãšã¯artisanã‚³ãƒãƒ³ãƒ‰ã§å˜ä½“[ãƒ†ã‚¹ãƒˆ](https://laravel.com/docs/12.x/database-testing)ã‚¯ãƒ©ã‚¹ã®é››å½¢ã‚’ä½œæˆã—ã¾ã™ã€‚

```shell-session
~/php/example-app $ php artisan make:test ChatTest --unit
```

ä¸­èº«ã‚’åŸ‹ã‚ãŸãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒã“ã¡ã‚‰ã€‚

```php:tests/Unit/ChatTest.php
<?php

namespace Tests\Unit;

use Tests\TestCase;
use App\Models\Chat;
use App\Models\User;
use Illuminate\Foundation\Testing\RefreshDatabase;
use PHPUnit\Framework\Attributes\Test;
use Illuminate\Foundation\Testing\WithFaker;

class ChatTest extends TestCase
{
    use RefreshDatabase;
    use WithFaker;

    /**
     * åŒ¿åãƒãƒ£ãƒƒãƒˆãŒä½œæˆã§ãã‚‹ã“ã¨ã‚’ç¢ºèª
     */
    #[Test]
    public function created(): void
    {
        $chat = Chat::factory()->state(['user_id' => null])->create();

        $this->assertDatabaseHas('chats', [
            'id' => $chat->id,
            'user_id' => null,
            'message' => $chat->message,
        ]);
        $this->assertInstanceOf(Chat::class, $chat);
        $this->assertNull($chat->user_id);
    }

    /**
     * ãƒ¦ãƒ¼ã‚¶ãƒ¼ä»˜ããƒãƒ£ãƒƒãƒˆãŒä½œæˆã§ãã‚‹ã“ã¨ã‚’ç¢ºèª
     */
    #[Test]
    public function created_with_a_user(): void
    {
        $user = User::factory()->create();
        $chat = Chat::factory()->for($user)->create();

        $this->assertDatabaseHas('chats', [
            'id' => $chat->id,
            'user_id' => $user->id,
            'message' => $chat->message,
        ]);
        $this->assertEquals($user->id, $chat->user->id);
        $this->assertInstanceOf(User::class, $chat->user);
    }

    /**
     * ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›´æ–°ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª
     */
    #[Test]
    public function message_updated(): void
    {
        $chat = Chat::factory()->create();
        $originalMessage = $chat->message;
        $updatedMessage = 'Updated message for chat: ' . $this->faker->sentence();

        $chat->update(['message' => $updatedMessage]);

        $this->assertDatabaseHas('chats', [
            'id' => $chat->id,
            'message' => $updatedMessage,
        ]);
        $this->assertEquals($updatedMessage, $chat->message);
        $this->assertNotEquals($originalMessage, $chat->message);
    }

    /**
     * å‰Šé™¤ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª
     */
    #[Test]
    public function deleted(): void
    {
        $chat = Chat::factory()->create();

        $chat->delete();

        $this->assertDatabaseMissing('chats', [
            'id' => $chat->id,
        ]);
    }

    /**
     * cascadeã®ç¢ºèª
     */
    #[Test]
    public function deleted_when_user_deleted(): void
    {
        $user = User::factory()->create();
        $chat = Chat::factory()->for($user)->create();

        $this->assertDatabaseHas('chats', ['id' => $chat->id]);

        $user->delete();

        // cascadeã®ç¢ºèª
        $this->assertDatabaseMissing('chats', ['id' => $chat->id]);
    }
}
```

å…ƒã€…ç”¨æ„ã•ã‚Œã¦ã‚‹ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ã‚‚åŒæ™‚ã«å‹•ãã¾ã™ãŒã€ä»Šä½œã£ãŸãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ã‚’å«ã‚ã¦å…¨ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æŒ‡ç¤ºã—ã¾ã™ã€‚

```shell-session
~/php/example-app $ php artisan test

   PASS  Tests\Unit\ChatTest
  âœ“ created                                                                         0.33s
  âœ“ created with a user                                                             0.03s
  âœ“ message updated                                                                 0.02s
  âœ“ deleted                                                                         0.02s
  âœ“ deleted when user deleted                                                       0.02s

   PASS  Tests\Unit\ExampleTest
  âœ“ that true is true                                                               0.33s

   PASS  Tests\Feature\Auth\AuthenticationTest
...
   PASS  Tests\Feature\Settings\ProfileUpdateTest
...
  âœ“ user can delete their account                                                   0.03s
  âœ“ correct password must be provided to delete account                             0.03s

  Tests:    32 passed (76 assertions)
  Duration: 3.49s

~/php/example-app $
```

Termuxã ã¨xdebugãŒä½¿ãˆãªã„ã®ã§[ã‚«ãƒãƒ¬ãƒƒã‚¸](https://ja.wikipedia.org/wiki/%E3%82%B3%E3%83%BC%E3%83%89%E7%B6%B2%E7%BE%85%E7%8E%87)ã‚‚å–ã‚Œãªã„ã—ã€ãƒ†ã‚¹ãƒˆã«ã¤ã„ã¦å‡ºæ¥ã‚‹ã“ã¨ã‚‚ã“ã®è¾ºã¾ã§ã«ãªã‚Šã¾ã™ã€‚
